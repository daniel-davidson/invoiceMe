# Settings API Contract
# InvoiceMe MVP - User Settings

openapi: 3.0.3
info:
  title: InvoiceMe Settings API
  version: 1.0.0
  description: User profile and settings endpoints

paths:
  /settings/profile:
    get:
      summary: Get current user profile
      operationId: getProfile
      tags: [Settings]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: User profile
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserProfile'
        '401':
          $ref: '#/components/responses/Unauthorized'

    patch:
      summary: Update user profile
      operationId: updateProfile
      tags: [Settings]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateProfileRequest'
      responses:
        '200':
          description: Profile updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserProfile'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /settings/currency:
    get:
      summary: Get available currencies
      operationId: getAvailableCurrencies
      tags: [Settings]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: List of available currencies
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Currency'
        '401':
          $ref: '#/components/responses/Unauthorized'

    patch:
      summary: Update system currency
      operationId: updateSystemCurrency
      tags: [Settings]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [systemCurrency]
              properties:
                systemCurrency:
                  type: string
                  pattern: "^[A-Z]{3}$"
                  example: "EUR"
      responses:
        '200':
          description: Currency updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  systemCurrency:
                    type: string
                  message:
                    type: string
                    example: "System currency updated. Normalized amounts will be recalculated."
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /export/invoices:
    get:
      summary: Export invoices as CSV
      operationId: exportInvoices
      tags: [Export]
      security:
        - bearerAuth: []
      parameters:
        - name: vendorId
          in: query
          schema:
            type: string
            format: uuid
          description: Filter by vendor
        - name: startDate
          in: query
          schema:
            type: string
            format: date
        - name: endDate
          in: query
          schema:
            type: string
            format: date
      responses:
        '200':
          description: CSV file download
          headers:
            Content-Disposition:
              schema:
                type: string
                example: 'attachment; filename="invoices_2026-01-18.csv"'
          content:
            text/csv:
              schema:
                type: string
                description: CSV formatted invoice data
        '401':
          $ref: '#/components/responses/Unauthorized'

  /export/analytics:
    get:
      summary: Export analytics data as CSV
      operationId: exportAnalytics
      tags: [Export]
      security:
        - bearerAuth: []
      parameters:
        - name: vendorId
          in: query
          schema:
            type: string
            format: uuid
          description: Export for specific vendor (omit for all)
        - name: year
          in: query
          schema:
            type: integer
      responses:
        '200':
          description: CSV file download
          headers:
            Content-Disposition:
              schema:
                type: string
                example: 'attachment; filename="analytics_2026-01-18.csv"'
          content:
            text/csv:
              schema:
                type: string
        '401':
          $ref: '#/components/responses/Unauthorized'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  responses:
    Unauthorized:
      description: Authentication required
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    BadRequest:
      description: Validation error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

  schemas:
    UserProfile:
      type: object
      properties:
        id:
          type: string
          format: uuid
        email:
          type: string
          format: email
        fullName:
          type: string
        personalBusinessId:
          type: string
          nullable: true
        systemCurrency:
          type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        stats:
          type: object
          properties:
            vendorCount:
              type: integer
            invoiceCount:
              type: integer
            totalSpendThisMonth:
              type: number

    UpdateProfileRequest:
      type: object
      properties:
        fullName:
          type: string
          minLength: 1
          maxLength: 100
        personalBusinessId:
          type: string
          maxLength: 50
          nullable: true

    Currency:
      type: object
      properties:
        code:
          type: string
          example: "USD"
        name:
          type: string
          example: "United States Dollar"
        symbol:
          type: string
          example: "$"
        flag:
          type: string
          example: "ðŸ‡ºðŸ‡¸"

    ErrorResponse:
      type: object
      properties:
        statusCode:
          type: integer
        message:
          type: string
        error:
          type: string
