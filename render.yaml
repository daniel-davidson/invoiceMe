# ==========================================
# Render Deployment Configuration
# ==========================================
# Docs: https://render.com/docs/blueprint-spec

services:
  # Backend API Service
  - type: web
    name: invoiceme-backend
    env: docker
    dockerfilePath: ./backend/Dockerfile
    dockerContext: ./backend
    
    # Region (choose closest to your users)
    region: oregon
    
    # Instance type
    plan: free # Options: free, starter ($7/mo), standard ($25/mo)
    
    # Health check (Render will call this endpoint)
    healthCheckPath: /health
    
    # Auto-deploy on push
    autoDeploy: true
    
    # Environment variables (set in Render dashboard)
    # IMPORTANT: Add actual values in dashboard, not here
    envVars:
      - key: NODE_ENV
        value: production
      
      - key: PORT
        value: 3000
      
      # Database (from Supabase)
      - key: DATABASE_URL
        sync: false # Set in dashboard
      
      # Supabase Auth
      - key: SUPABASE_URL
        sync: false
      - key: SUPABASE_SECRET_KEY
        sync: false
      - key: SUPABASE_JWKS_URL
        sync: false
      
      # LLM Provider (Groq)
      - key: LLM_PROVIDER
        value: groq
      - key: LLM_API_KEY
        sync: false # GROQ_API_KEY
      - key: LLM_MODEL
        value: mixtral-8x7b-32768
      
      # OCR
      - key: OCR_PROVIDER
        value: tesseract
      - key: TESSERACT_LANGS
        value: eng+heb
      
      # Currency API
      - key: FX_PROVIDER
        value: frankfurter
      - key: FX_API_URL
        value: https://api.frankfurter.app
      
      # Storage
      - key: STORAGE_DIR
        value: ./uploads
      
      # CORS (update after frontend deployment)
      - key: CORS_ORIGINS
        value: https://invoiceme.pages.dev,https://your-custom-domain.com
