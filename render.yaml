# ==========================================
# Render Deployment Configuration
# ==========================================
# Docs: https://render.com/docs/blueprint-spec

services:
  # Backend API Service
  - type: web
    name: invoiceme-backend
    env: docker
    dockerfilePath: ./backend/Dockerfile
    dockerContext: ./backend
    
    # Region (choose closest to your users)
    region: oregon
    
    # Instance type
    plan: free # Options: free, starter ($7/mo), standard ($25/mo)
    
    # Health check (Render will call this endpoint)
    healthCheckPath: /health
    
    # Auto-deploy on push
    autoDeploy: true
    
    # Environment variables
    # IMPORTANT: Secret values (DATABASE_URL, API keys) must be set in Render dashboard
    # This file only defines keys with default/placeholder values
    envVars:
      - key: NODE_ENV
        value: production
      
      - key: PORT
        value: 3000
      
      # Database (from Supabase) - SET IN DASHBOARD
      - key: DATABASE_URL
        generateValue: false
      
      # Supabase Auth - SET IN DASHBOARD
      - key: SUPABASE_URL
        generateValue: false
      - key: SUPABASE_SECRET_KEY
        generateValue: false
      - key: SUPABASE_JWKS_URL
        generateValue: false
      
      # LLM Provider (Groq)
      - key: LLM_PROVIDER
        value: groq
      - key: LLM_API_KEY
        generateValue: false
      - key: LLM_MODEL
        value: llama-3.1-70b-versatile
      
      # OCR
      - key: OCR_PROVIDER
        value: tesseract
      - key: TESSERACT_LANGS
        value: eng+heb
      
      # Currency API
      - key: FX_PROVIDER
        value: frankfurter
      - key: FX_API_URL
        value: https://api.frankfurter.app
      
      # Storage
      - key: STORAGE_DIR
        value: ./uploads
      
      # CORS (update after frontend deployment)
      - key: CORS_ORIGINS
        value: https://invoiceme.pages.dev,https://your-custom-domain.com
