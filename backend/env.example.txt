# ============================================
# InvoiceMe Backend - Environment Configuration
# ============================================
# Rename this file to .env and fill in the values
# See SETUP_GUIDE.md for detailed instructions

# ============================================
# DATABASE
# ============================================
# PostgreSQL connection string
# 
# Option 1: Supabase Session Pooler (RECOMMENDED - IPv4 compatible)
#   ⚠️  IMPORTANT: Use "Session pooler" NOT "Direct connection" (IPv6 only on free tier)
#   Get from: Supabase Dashboard → Settings → Database → Connection string → "Session pooler"
#   Port 5432 = Session mode (for typical app usage)
#   Port 6543 = Transaction mode (for serverless/edge functions)
#   
#   NOTE: For Node.js/Prisma, replace sslmode=require with sslmode=no-verify to avoid SSL cert errors:
#   DATABASE_URL="postgresql://postgres.[project-ref]:[password]@aws-0-[region].pooler.supabase.com:5432/postgres?sslmode=no-verify&pgbouncer=true"
#
# Option 2: Local PostgreSQL
#   DATABASE_URL="postgresql://postgres:password@localhost:5432/invoiceme"
#
# Option 3: Neon (Free tier, IPv4 compatible)
#   DATABASE_URL="postgresql://user:pass@ep-xxx.us-east-1.aws.neon.tech/neondb"
DATABASE_URL="postgresql://postgres:your-password@localhost:5432/invoiceme?schema=public"

# ============================================
# SUPABASE AUTH - Choose ONE of the options below
# ============================================
# Get all from: https://app.supabase.com/project/[project-id]/settings/api

# Project URL (same for both options)
SUPABASE_URL="https://your-project-ref.supabase.co"

# ===== OPTION A: New Key System (Projects after May 2025) =====
# Supabase now uses Publishable/Secret keys with asymmetric JWT signing
#
# Publishable Key (under "API Keys" → starts with sb_publishable_)
SUPABASE_PUBLISHABLE_KEY="sb_publishable_..."

# Secret Key (under "API Keys" → starts with sb_secret_, click "Reveal")
# ⚠️ NEVER expose this in frontend code
SUPABASE_SECRET_KEY="sb_secret_..."

# JWKS URL for JWT verification (asymmetric keys)
# Format: https://[project-ref].supabase.co/auth/v1/.well-known/jwks.json
SUPABASE_JWKS_URL="https://your-project-ref.supabase.co/auth/v1/.well-known/jwks.json"

# ===== OPTION B: Legacy Key System (Projects before May 2025) =====
# If your project still uses anon/service_role JWT-based keys
#
# anon/public key (under "Project API keys")
# SUPABASE_ANON_KEY="eyJ..."
#
# service_role key (click "Reveal" under "Project API keys")
# SUPABASE_SERVICE_ROLE_KEY="eyJ..."
#
# JWT Secret for verifying tokens (Settings → API → JWT Settings → Reveal)
# JWT_SECRET="your-jwt-secret"

# ============================================
# LLM SERVICE
# ============================================
# Choose ONE provider: groq (production), ollama (local dev), together, openrouter

# Provider selection (groq is default for production)
LLM_PROVIDER="groq"

# --- Option 1: Groq (Cloud - FREE tier, RECOMMENDED for production) ---
# Get key: https://console.groq.com/keys
# Models: mixtral-8x7b-32768 (best accuracy), llama-3.1-70b-versatile, llama-3.2-3b-preview
LLM_API_KEY="gsk_..."
LLM_MODEL="mixtral-8x7b-32768"
# Alternative env var names also supported:
# GROQ_API_KEY="gsk_..."
# GROQ_MODEL="mixtral-8x7b-32768"

# --- Option 2: Ollama (Local/Self-hosted - for offline development) ---
# No API key needed, requires local Ollama running
# LLM_PROVIDER="ollama"
# OLLAMA_URL="http://localhost:11434"
# OLLAMA_MODEL="llama3.2:3b"

# --- Option 3: Together AI (Cloud - $25 credit) ---
# Get key: https://api.together.xyz/settings/api-keys
# LLM_PROVIDER="together"
# LLM_API_KEY="..."
# LLM_MODEL="meta-llama/Llama-3.2-3B-Instruct-Turbo"

# --- Option 4: OpenRouter (Cloud - Pay per use) ---
# Get key: https://openrouter.ai/keys
# LLM_PROVIDER="openrouter"
# LLM_API_KEY="sk-or-..."
# LLM_MODEL="meta-llama/llama-3.2-3b-instruct:free"

# ============================================
# OCR SERVICE
# ============================================
# Choose ONE provider: tesseract, google, ocrspace

# Provider selection
OCR_PROVIDER="tesseract"

# --- Option 1: Tesseract (Local) ---
# Install: brew install tesseract tesseract-lang (macOS)
#          apt install tesseract-ocr tesseract-ocr-heb (Ubuntu)
TESSERACT_LANGS="eng+heb"
# TESSERACT_PATH="/opt/homebrew/bin/tesseract"  # Optional, if not in PATH

# Enable OCR debug logging (shows preprocessing, PSM scores, text previews)
# Set to "true" for development/troubleshooting
OCR_DEBUG="false"

# --- Option 2: Google Cloud Vision (Cloud - 1000 free/month) ---
# Setup: https://cloud.google.com/vision/docs/setup
# OCR_PROVIDER="google"
# GOOGLE_APPLICATION_CREDENTIALS="/path/to/service-account.json"

# --- Option 3: OCR.space (Cloud - 25000 free/month) ---
# Get key: https://ocr.space/ocrapi
# OCR_PROVIDER="ocrspace"
# OCR_API_KEY="..."

# ============================================
# CURRENCY API
# ============================================
# Choose ONE provider: frankfurter, openexchangerates, exchangerateapi

# --- Option 1: Frankfurter (FREE - No API key needed!) ---
# Docs: https://www.frankfurter.app/docs/
# 10000+ requests/day, all currencies supported
FX_PROVIDER="frankfurter"
FX_API_URL="https://api.frankfurter.app"

# --- Option 2: Open Exchange Rates (1000 free/month, USD base only) ---
# Get key: https://openexchangerates.org/signup/free
# FX_PROVIDER="openexchangerates"
# FX_API_KEY="..."

# --- Option 3: ExchangeRate-API (1500 free/month) ---
# Get key: https://www.exchangerate-api.com/
# FX_PROVIDER="exchangerateapi"
# FX_API_KEY="..."

# Cache TTL in milliseconds (default: 12 hours)
FX_CACHE_TTL_MS=43200000

# ============================================
# FILE STORAGE
# ============================================
# Directory for storing uploaded invoice files
# For production, consider using S3, GCS, or Supabase Storage
STORAGE_DIR="./uploads"

# Maximum file size in bytes (default: 10MB)
MAX_FILE_SIZE=10485760

# ============================================
# APPLICATION
# ============================================
# Server port
PORT=3000

# Environment: development, production, test
NODE_ENV=development

# CORS origins (comma-separated)
# Development: allow localhost
# Production: your frontend domain only
CORS_ORIGINS="http://localhost:3000,http://localhost:8080,http://localhost:*"

# ============================================
# OPTIONAL: SMTP (for custom auth emails)
# ============================================
# ⚠️ NOT REQUIRED! Supabase sends auth emails automatically.
# Only configure this if you want:
# - Emails from your own domain
# - Custom email templates
# - Higher volume limits
#
# SMTP_HOST="smtp.resend.com"
# SMTP_PORT=587
# SMTP_USER="resend"
# SMTP_PASS="re_..."
# SMTP_FROM="noreply@yourdomain.com"
